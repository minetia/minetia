<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/825/825540.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Construction Master Final v42 (Fixed)</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        /* [1. í…Œë§ˆ ë° ë³€ìˆ˜] */
        :root {
            --primary: #4f46e5; --bg-grad: linear-gradient(135deg, #111827 0%, #1f293b 100%);
            --card-bg: #1f2937;
            --text-main: #f3f4f6; --text-sub: #9ca3af;
            --input-bg: #111827; --border: 1px solid rgba(255,255,255,0.1);
            --up: #f87171; --down: #60a5fa; --nav-bg: #111827;
            --yt-red: #ff0000;
            --ai-bg: linear-gradient(135deg, #4338ca 0%, #7e22ce 100%);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg-grad); color: var(--text-main); 
            margin: 0; padding: 0; width: 100%; height: 100vh; overflow: hidden;
        }

        #app-frame { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column; 
            background: var(--bg-grad);
        }

        /* í˜ì´ì§€ ì»¨í…Œì´ë„ˆ */
        .page-container { 
            flex: 1; overflow-y: auto; 
            padding: 16px; 
            padding-bottom: 80px; 
            display: none; 
            width: 100%; 
            scroll-behavior: smooth;
        }
        .page-container.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* [PC í™”ë©´ ëŒ€ì‘] */
        @media (min-width: 1024px) {
            .home-grid-layout { display: flex; flex-direction: column; gap: 20px; max-width: 600px; margin: 0 auto; }
            .info-grid-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 100%; }
            #chartContainer { height: 85vh !important; }
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
        .nav-bar { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; 
            background: var(--nav-bg); border-top: var(--border); 
            display: flex; justify-content: space-around; align-items: center; 
            z-index: 1000; padding-bottom: env(safe-area-inset-bottom); 
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--text-sub); cursor: pointer; height: 100%; gap: 4px; }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        .nav-icon { font-size: 20px; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .app-title { font-size: 22px; font-weight: 800; color: #818cf8; margin: 0; }
        
        .icon-btn { 
            background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.1); 
            font-size: 18px; 
            cursor: pointer; 
            padding: 8px 12px; 
            border-radius: 8px;
            color: var(--text-main);
            margin-left: 5px;
        }
        
        .card { background: var(--card-bg); border-radius: 16px; padding: 20px; border: none; margin-bottom: 15px; width: 100%; }
        
        .tick-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; font-size: 16px; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 12px; }
        .tick-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .tick-label { font-size: 15px; color: #818cf8; display: flex; align-items: center; gap: 6px; font-weight: 800; }
        .tick-val { font-family: monospace; font-size: 20px; font-weight: 800; text-align: right; }
        .tick-sub { font-size: 12px; color: var(--text-sub); font-weight: 500; margin-top: 4px; text-align: right; }

        .rate-info-box { display: flex; justify-content: space-between; margin-top: 15px; font-size: 12px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .rate-item { display: flex; flex-direction: column; gap: 4px; }
        .rate-label { color: var(--text-sub); font-weight: 600; }
        .rate-val { font-weight: 700; color: var(--text-main); font-size: 14px; }

        .calc-mode-switch { display: flex; gap: 10px; margin-bottom: 20px; background: var(--input-bg); padding: 5px; border-radius: 12px; }
        .mode-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; background: transparent; color: var(--text-sub); font-weight: 700; cursor: pointer; transition: 0.2s; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        .inp-grid { display: grid; gap: 15px; width: 100%; }
        .inp-group { display: flex; justify-content: space-between; align-items: center; background: var(--input-bg); padding: 15px; border-radius: 12px; }
        .inp-label { font-size: 14px; color: var(--text-sub); font-weight: 600; }
        .inp-fld { width: 150px; background: transparent; border: none; color: var(--text-main); font-size: 16px; font-weight: 700; text-align: right; outline: none; }
        
        .btn-full { width: 100%; padding: 16px; border-radius: 12px; background: var(--primary); border: none; color: white; font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 15px; }

        .res-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; width: 100%; }
        .res-box { background: var(--input-bg); padding: 15px; border-radius: 12px; text-align: center; border: var(--border); }
        .res-box.main { grid-column: span 2; background: var(--primary); color: #fff; border: none; }
        .res-box.main .res-val { color: #fff; }
        .res-label { font-size: 11px; color: var(--text-sub); margin-bottom: 4px; }
        .res-box.main .res-label { color: rgba(255,255,255,0.8); }
        .res-val { font-size: 16px; font-weight: 800; color: var(--text-main); }
        .c-up { color: var(--up); } .c-down { color: var(--down); }

        .link-box { cursor: pointer; border: 1px solid var(--primary); background: rgba(79, 70, 229, 0.15); transition: 0.2s; }
        .link-box:active { transform: scale(0.98); }
        .link-box .res-label { color: var(--primary); font-weight: 700; }

        .ex-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; width: 100%; }
        .ex-item { padding: 15px; border-radius: 12px; text-align: center; font-size: 13px; font-weight: 700; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; background: var(--card-bg); }
        .ik { color: #93c5fd; } .iu { color: #fcd34d; }
        
        .indi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 10px 0; }
        .indi-card { background: var(--input-bg); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .indi-card:hover { transform: scale(1.02); border-color: var(--primary); }
        .indi-card.active { border-color: var(--primary); background: rgba(79, 70, 229, 0.15); box-shadow: 0 0 10px rgba(79, 70, 229, 0.2); }
        .indi-icon { font-size: 28px; }
        .indi-name { font-size: 13px; font-weight: 700; color: var(--text-main); }

        .detail-indi-grid { display: grid; grid-template-columns: 1fr; gap: 10px; padding: 10px 0; }
        @media (min-width: 600px) { .detail-indi-grid { grid-template-columns: 1fr 1fr; } }
        .detail-indi-card { background: var(--input-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; cursor: pointer; display: flex; align-items: flex-start; gap: 12px; transition: 0.2s; text-align: left; }
        .detail-indi-card:hover { background: rgba(79, 70, 229, 0.1); border-color: var(--primary); }
        .detail-indi-card.active { border: 1px solid var(--primary); background: rgba(79, 70, 229, 0.15); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .dic-icon { font-size: 24px; min-width: 40px; text-align: center; margin-top: 2px; }
        .dic-content { flex: 1; }
        .dic-name { font-size: 14px; font-weight: 800; color: var(--text-main); margin-bottom: 4px; }
        .dic-desc { font-size: 11px; color: var(--text-sub); line-height: 1.4; word-break: keep-all; }
        
        #chartContainer { width: 100%; height: 100%; min-height: 500px; background: #000; border-radius: 16px; overflow: hidden; }
        
        /* [ìˆ˜ì •ë¨] ìœ íŠœë¸Œ í”Œë ˆì´ì–´ (ì˜¤ë²„ë ˆì´ ì œê±°, ë²„íŠ¼ ë°°ì¹˜ ìµœì í™”) */
        #ytPlayerContainer {
            width: calc(100% + 32px); /* ê°€ë¡œ ê½‰ ì°¨ê²Œ */
            margin-left: -16px; 
            position: relative; 
            margin-bottom: 20px;
            display: none; 
            transition: all 0.3s ease-in-out;
            z-index: 100;
        }
        
        #ytPlayerWrapper { 
            width: 100%; 
            aspect-ratio: 16/9; 
            background: #000; 
            overflow: hidden; 
            position: relative; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* 1. ìŠ¤í¬ë¡¤ ë‚´ë ¸ì„ ë•Œ ìƒë‹¨ ê³ ì • (Sticky Top) */
        #ytPlayerContainer.sticky-top-mode {
            position: fixed;
            top: 0; left: 0; width: 100%;
            margin-left: 0; margin-bottom: 0;
            z-index: 9999;
            box-shadow: 0 5px 20px rgba(0,0,0,0.7);
            animation: slideDown 0.3s forwards;
        }

        /* 2. â˜… ì„¸ë¡œ/ê°€ë¡œ í’€ìŠ¤í¬ë¦° ëª¨ë“œ â˜… */
        #ytPlayerContainer.full-mode {
            position: fixed;
            top: 0; left: 0;
            width: 100vw !important;
            height: 100vh !important;
            margin: 0 !important;
            z-index: 20000; /* ìµœìƒìœ„ */
            background: #000;
        }
        #ytPlayerContainer.full-mode #ytPlayerWrapper {
            width: 100%; height: 100%;
            aspect-ratio: unset;
            border-radius: 0;
        }
        /* ì „ì²´í™”ë©´ì¼ ë•Œ ì†Œë¦¬ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • */
        #ytPlayerContainer.full-mode .yt-sound-btn {
            top: 80px; bottom: auto; right: 20px;
        }

        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }

        #ytPlaceholder { display: none; width: 100%; aspect-ratio: 16/9; }
        
        /* iframe: pointer-events autoë¡œ í„°ì¹˜ ê°€ëŠ¥í•˜ê²Œ */
        #ytIframe { width: 100%; height: 100%; border: none; pointer-events: auto; }
        
        /* ì†Œë¦¬ ì¼œê¸° ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) */
        .yt-sound-btn {
            position: absolute; top: 15px; right: 15px; 
            background: rgba(79, 70, 229, 0.9); color: #fff;
            border: none; border-radius: 20px; padding: 6px 14px;
            font-size: 12px; font-weight: 700; cursor: pointer; z-index: 50; /* iframe ìœ„ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            pointer-events: auto;
        }

        /* ê½‰ì°¬ í™”ë©´ ë²„íŠ¼ (ì¤‘ì•™ í•˜ë‹¨) */
        .yt-full-btn {
            position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7); color: #fff; border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px; padding: 6px 14px;
            font-size: 12px; font-weight: 700; cursor: pointer; z-index: 50;
            backdrop-filter: blur(4px);
            pointer-events: auto;
        }
        
        .sticky-search { position: sticky; top: -20px; z-index: 10; background: var(--bg-grad); padding-bottom: 10px; padding-top: 5px; margin-bottom: 10px; }
        
        /* ì •ë³´ ë©”ë‰´ ê·¸ë¦¬ë“œ (100ê°œ ëŒ€ì‘) */
        .info-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .info-menu-item {
            background: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .info-menu-item:hover { border-color: var(--primary); background: rgba(79, 70, 229, 0.1); transform: translateY(-2px); }
        .info-menu-icon { font-size: 24px; }
        .info-menu-title { font-size: 12px; font-weight: 700; color: var(--text-main); word-break: keep-all; line-height: 1.3; }

        .info-card { background: var(--input-bg); padding: 16px; border-radius: 12px; border: var(--border); margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .info-back { cursor: pointer; font-size: 14px; color: var(--text-sub); margin-bottom: 15px; display: inline-flex; align-items: center; font-weight: 700; padding: 8px 0; }
        .post-tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: var(--primary); color: #fff; margin-right: 6px; }
        
        #detailChartContainer { width: 100%; height: 300px; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 15px; border: var(--border); }

        .ai-report-box { background: var(--input-bg); border-radius: 12px; padding: 20px; margin-top: 10px; border: 1px solid var(--primary); width: 100%; }
        .ai-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .ai-badge { background: var(--ai-bg); color: #fff; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 800; }
        .ai-score { font-size: 24px; font-weight: 900; color: var(--primary); }
        .strat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .strat-item { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; text-align: center; }
        .strat-label { font-size: 11px; color: var(--text-sub); margin-bottom: 4px; }
        .strat-val { font-size: 14px; font-weight: 800; line-height: 1.3; }
        .long-term-box { background: rgba(79, 70, 229, 0.1); padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 3px solid var(--primary); }
        .price-dual { display: flex; justify-content: center; align-items: baseline; gap: 8px; margin-bottom: 10px; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: flex-end; backdrop-filter: blur(4px); }
        .modal-con { background: var(--card-bg); width: 100%; max-width: 600px; height: 80vh; border-top-left-radius: 24px; border-top-right-radius: 24px; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; animation: slideUp 0.3s; }
        @media (min-width: 768px) { .modal { align-items: center; } .modal-con { height: auto; max-height: 80vh; border-radius: 20px; width: 600px; transform: none; animation: fadeIn 0.2s; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .yt-item { display: flex; gap: 12px; padding: 12px; background: var(--input-bg); border-radius: 12px; border: 1px solid transparent; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .yt-item:hover { border-color: var(--yt-red); background: rgba(255,0,0,0.05); }
        .yt-thumb { width: 120px; height: 68px; background: #000; border-radius: 8px; flex-shrink: 0; background-size: cover; background-position: center; }
        .yt-info { display: flex; flex-direction: column; justify-content: center; gap: 4px; overflow: hidden; }
        .yt-title { font-size: 14px; font-weight: 700; color: var(--text-main); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .yt-chan { font-size: 11px; color: var(--text-sub); }
        
        #ytBoardContainer { display: none; background: var(--input-bg); border-radius: 12px; padding: 10px; margin-bottom: 15px; border: 1px solid var(--primary); max-height: 300px; overflow-y: auto; }
        .yt-board-item { padding: 10px 15px; border-bottom: 1px solid var(--border); cursor: pointer; font-size: 14px; color: var(--text-main); display: flex; justify-content: space-between; }
        
        .detail-body { font-size: 15px; line-height: 1.7; color: var(--text-main); white-space: pre-wrap; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app-frame">
    <div id="page-home" class="page-container active">
        <div class="header">
            <h1 class="app-title" id="homeTitle">ì—…ë¹„íŠ¸ ê³„ì‚°ê¸°</h1>
            <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">â˜€ï¸</button>
        </div>

        <div class="home-grid-layout">
            <div class="card">
                <div style="margin-bottom:20px; position: relative;">
                    <input type="text" id="search" class="inp-fld" placeholder="ì½”ì¸ëª… ê²€ìƒ‰ (ì˜ˆ: XRP)" style="text-align:left; padding-left:10px; width: 100%; background: rgba(0,0,0,0.2);" onkeyup="if(event.key==='Enter') chgCoin()">
                    <button onclick="chgCoin()" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); border:none; background:none; font-size:18px; cursor:pointer;">ğŸ”</button>
                </div>
                
                <div class="tick-row">
                    <span class="tick-label"><span id="lblKrSym">BTC</span> (KRW)</span>
                    <span id="tKr" class="tick-val" style="color:#818cf8">Connecting...</span>
                </div>
                <div class="tick-row">
                    <span class="tick-label"><span id="lblUsSym">BTC</span> (USDT)</span>
                    <div style="text-align:right;">
                        <div id="tUs" class="tick-val" style="color:#f59e0b">Connecting...</div>
                        <div class="tick-sub" id="tUsCvt">â‰ˆ 0 KRW</div>
                    </div>
                </div>
                
                <div class="rate-info-box">
                    <div class="rate-item"><span class="rate-label">ğŸ”¥ ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„</span><span class="rate-val" id="premVal">ê³„ì‚°ì¤‘...</span></div>
                    <div class="rate-item" style="text-align:right;"><span class="rate-label">ğŸ‡ºğŸ‡¸ ì‹¤ì‹œê°„ í™˜ìœ¨</span><span class="rate-val" id="exRateVal">1,450 ì›</span></div>
                </div>
            </div>

            <div class="card" style="height:fit-content;">
                <div class="calc-mode-switch">
                    <button id="btnKrw" class="mode-btn active" onclick="setCalcMode('KRW')">ğŸ‡°ğŸ‡· ì›í™” (KRW)</button>
                    <button id="btnUsdt" class="mode-btn" onclick="setCalcMode('USDT')">ğŸŒ ë‹¬ëŸ¬ (USDT)</button>
                </div>

                <div class="inp-grid">
                    <div class="inp-group"><span class="inp-label">ë‚´ í‰ë‹¨</span><input type="number" id="cP" class="inp-fld" placeholder="0" oninput="cal()"></div>
                    <div class="inp-group"><span class="inp-label">ë³´ìœ  ìˆ˜ëŸ‰</span><input type="number" id="cQ" class="inp-fld" placeholder="0" oninput="cal()"></div>
                    <div class="inp-group"><span class="inp-label">ë¬¼íƒˆ ê°€ê²©</span><input type="number" id="nP" class="inp-fld" placeholder="í˜„ì¬ê°€ ì ìš©" oninput="cal()"></div>
                    <div class="inp-group"><span class="inp-label">ë¬¼íƒˆ ê¸ˆì•¡</span><input type="number" id="nA" class="inp-fld" placeholder="ê¸ˆì•¡ ì…ë ¥" oninput="cal(1)"></div>
                    <div class="inp-group"><span class="inp-label">ë¬¼íƒˆ ìˆ˜ëŸ‰</span><input type="number" id="nQ" class="inp-fld" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" oninput="cal(0)"></div>
                </div>
            </div>

            <div>
                <div class="res-grid">
                    <div class="res-box main"><div class="res-label">ìµœì¢… í‰ë‹¨ê°€</div><div class="res-val" id="fAv">0</div></div>
                    <div class="res-box"><div class="res-label">ìˆ˜ìµë¥ </div><div class="res-val" id="resPnl">0.00%</div></div>
                    <div class="res-box"><div class="res-label">ì´ ìˆ˜ëŸ‰</div><div class="res-val" id="resQty">0</div></div>
                    <div class="res-box"><div class="res-label">ì´ ê¸ˆì•¡</div><div class="res-val" id="resAmt">0</div></div>
                    <div class="res-box link-box" onclick="goToNewsBoard()">
                        <div class="res-label">AI ë¶„ì„</div><div class="res-val">ğŸ“° ê´€ë ¨ ë‰´ìŠ¤</div>
                    </div>
                </div>
                <button class="btn-full" onclick="rst()">ì´ˆê¸°í™”</button>
            </div>
        </div>
    </div>

    <div id="page-ex" class="page-container">
        <div class="header"><h1 class="app-title">ê±°ë˜ì†Œ ì„ íƒ</h1></div>
        <div class="ex-grid">
            <div class="ex-item ik" onclick="setEx('UPBIT','ì—…ë¹„íŠ¸')">ì—…ë¹„íŠ¸</div>
            <div class="ex-item ik" onclick="setEx('BITHUMB','ë¹—ì¸')">ë¹—ì¸</div>
            <div class="ex-item ik" onclick="setEx('COINONE','ì½”ì¸ì›')">ì½”ì¸ì›</div>
            <div class="ex-item ik" onclick="setEx('KORBIT','ì½”ë¹—')">ì½”ë¹—</div>
            <div class="ex-item ik" onclick="setEx('GOPAX','ê³ íŒìŠ¤')">ê³ íŒìŠ¤</div>
        </div>
        <div style="font-size:14px; font-weight:700; color:var(--text-sub); margin-bottom:15px; margin-top:30px;">í•´ì™¸ (USDT/USD)</div>
        <div class="ex-grid">
            <div class="ex-item iu" onclick="setEx('BINANCE','ë°”ì´ë‚¸ìŠ¤')">ë°”ì´ë‚¸ìŠ¤</div>
            <div class="ex-item iu" onclick="setEx('BYBIT','ë°”ì´ë¹„íŠ¸')">ë°”ì´ë¹„íŠ¸</div>
            <div class="ex-item iu" onclick="setEx('OKX','OKX')">OKX</div>
            <div class="ex-item iu" onclick="setEx('BITGET','ë¹„íŠ¸ê²Ÿ')">ë¹„íŠ¸ê²Ÿ</div>
            <div class="ex-item iu" onclick="setEx('COINBASE','ì½”ì¸ë² ì´ìŠ¤')">ì½”ì¸ë² ì´ìŠ¤</div>
            <div class="ex-item iu" onclick="setEx('KRAKEN','í¬ë¼ì¼„')">í¬ë¼ì¼„</div>
            <div class="ex-item iu" onclick="setEx('GATEIO','ê²Œì´íŠ¸')">ê²Œì´íŠ¸</div>
            <div class="ex-item iu" onclick="setEx('KUCOIN','ì¿ ì½”ì¸')">ì¿ ì½”ì¸</div>
            <div class="ex-item iu" onclick="setEx('HUOBI','HTX')">HTX</div>
            <div class="ex-item iu" onclick="setEx('BITSTAMP','ë¹„íŠ¸ìŠ¤íƒ¬í”„')">ë¹„íŠ¸ìŠ¤íƒ¬í”„</div>
        </div>
    </div>

    <div id="page-info" class="page-container">
        <div class="header"><h1 class="app-title">ì •ë³´ ì„¼í„°</h1></div>
        <div class="sticky-search">
            <input type="text" id="infoSearch" class="inp-fld" placeholder="ì½”ì¸ ë‰´ìŠ¤ ê²€ìƒ‰" style="text-align:left; background:var(--card-bg); width:100%; border:1px solid var(--primary);" onkeyup="searchInfo()">
        </div>
        
        <div class="info-grid-layout">
            <div>
                <div id="infoMenuContainer" class="info-menu-grid"></div>
                <div id="infoBoardContainer" style="display:none;">
                    <div class="info-back" onclick="closeBoard()">â—€ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</div>
                    <h2 id="boardTitle" style="margin:0 0 15px 0; font-size:18px;">ê²Œì‹œíŒ</h2>
                    <div id="boardList"></div>
                </div>
            </div>
            <div id="infoDetailContainer" style="display:none;">
                <div class="info-back" onclick="closeDetail()">â—€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</div>
                <div class="detail-title" id="detailTitle">ì œëª©</div>
                <div class="detail-date" id="detailDate">ë‚ ì§œ</div>
                <div id="detailChartContainer"></div>
                <div id="aiAnalysisContainer"></div>
                <div class="detail-body" id="detailBody"></div>
            </div>
        </div>
    </div>

    <div id="page-youtube" class="page-container">
        <div class="header">
            <h1 class="app-title">ìœ íŠœë¸Œ</h1>
            <button class="icon-btn" onclick="toggleYtBoard()" style="font-size:14px; font-weight:700; color:var(--primary);">ğŸ“‹ ì¶”ì²œ ì±„ë„</button>
        </div>
        
        <div class="sticky-search">
             <div id="ytBoardContainer"></div>
             <div style="display:flex; gap:5px; margin-bottom:5px;">
                <select id="ytSort" style="padding:8px; border-radius:8px; border:1px solid var(--border); background:var(--input-bg); color:var(--text-main); font-weight:bold;">
                    <option value="relevance">ê´€ë ¨ë„ìˆœ</option>
                    <option value="date">ìµœì‹ ìˆœ (ë‚ ì§œ)</option>
                    <option value="viewCount">ì¡°íšŒìˆ˜ìˆœ (ì¸ê¸°)</option>
                </select>
                <input type="text" id="ytSearch" class="inp-fld" placeholder="ì˜ìƒ ê²€ìƒ‰ (ì˜ˆ: ë¹„íŠ¸ì½”ì¸)" style="text-align:left; background:var(--card-bg); width:100%; border:1px solid var(--primary); flex:1;" onkeyup="if(event.key==='Enter') searchYoutube()">
             </div>
        </div>

        <div id="ytPlayerContainer">
            <div id="ytPlayerWrapper">
                <button id="ytSoundBtn" class="yt-sound-btn" onclick="unmuteVideo()">ğŸ”Š ì†Œë¦¬ ì¼œê¸°</button>
                
                <button class="yt-full-btn" onclick="toggleVerticalFull()">ğŸ“± ì„¸ë¡œ ê½‰ì°¬í™”ë©´</button>

                <iframe id="ytIframe" src="" allowfullscreen allow="autoplay; encrypted-media"></iframe>
            </div>
        </div>
        <div id="ytPlaceholder"></div>

        <div id="youtubeList">
            <div style="padding:20px; text-align:center; color:var(--text-sub)">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì¶”ì²œ ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”.</div>
        </div>
    </div>

    <div id="page-chart" class="page-container" style="height:100%;">
        <div class="header">
            <h1 class="app-title">ì°¨íŠ¸</h1>
            <div style="display:flex;">
                <button class="icon-btn" onclick="el('indiModal').style.display='flex'">ğŸ“Š</button>
                <button class="icon-btn" onclick="openDetailIndiModal()">ğŸ“‚</button>
            </div>
        </div>
        <div id="chartContainer"></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="goPage('home')"><span class="nav-icon">ğŸ </span><span>í™ˆ</span></div>
        <div class="nav-item" onclick="goPage('youtube')"><span class="nav-icon">ğŸ“º</span><span>ìœ íŠœë¸Œ</span></div>
        <div class="nav-item" onclick="goPage('chart')"><span class="nav-icon">ğŸ“ˆ</span><span>ì°¨íŠ¸</span></div>
        <div class="nav-item" onclick="goPage('ex')"><span class="nav-icon">ğŸ¦</span><span>ê±°ë˜ì†Œ</span></div>
        <div class="nav-item" onclick="goPage('info')"><span class="nav-icon">â„¹ï¸</span><span>ì •ë³´</span></div>
    </div>

    <div id="indiModal" class="modal" onclick="if(event.target==this)this.style.display='none'">
        <div class="modal-con">
            <div class="mod-head" style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:18px; font-weight:bold;">ë³´ì¡°ì§€í‘œ (ì•„ì´ì½˜)</span>
                <span onclick="el('indiModal').style.display='none'" style="cursor:pointer; font-size:20px;">âœ•</span>
            </div>
            <div id="indiList" class="indi-grid"></div>
            <button class="btn-full" onclick="applyStudies()" style="background:var(--primary); color:#fff;">ì ìš©í•˜ê¸°</button>
        </div>
    </div>

    <div id="detailIndiModal" class="modal" onclick="if(event.target==this)this.style.display='none'">
        <div class="modal-con" style="max-width:800px; height:90vh;">
            <div class="mod-head" style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:18px; font-weight:bold;">ì „ì²´ ì§€í‘œ ëª©ë¡</span>
                <span onclick="el('detailIndiModal').style.display='none'" style="cursor:pointer; font-size:20px;">âœ•</span>
            </div>
            <div id="detailIndiList" class="detail-indi-grid"></div>
            <button class="btn-full" onclick="applyStudies()" style="background:var(--primary); color:#fff; margin-top:20px;">ì ìš©í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    const YOUTUBE_API_KEY = 'AIzaSyBlKZbCP6qZiv3NLBmgh4iled9Y4BmCUM8'; 

    const el = id => document.getElementById(id);
    let curSym = localStorage.getItem('curSym') || 'BTC';
    let curExCode = localStorage.getItem('curExCode') || 'UPBIT';
    let activeStudies = JSON.parse(localStorage.getItem('activeStudies')) || ["MASimple@tv-basicstudies", "Volume@tv-basicstudies"];
    
    let priceKr = 0; let priceUs = 0; let exRate = 1450;
    let isDetailOpen = false; let detailSymbol = ''; let currentBoardData = [];
    let calcMode = 'KRW';
    let currentVideoId = '';
    let isVerticalFull = false;

    const coinMap = { "ë¹„íŠ¸":"BTC", "btc":"BTC", "ì´ë”":"ETH", "eth":"ETH", "ë¦¬í”Œ":"XRP", "xrp":"XRP", "ë„ì§€":"DOGE", "doge":"DOGE", "ì†”ë¼ë‚˜":"SOL", "sol":"SOL", "ì—ì´ë‹¤":"ADA", "ada":"ADA", "íŠ¸ë¡ ":"TRX", "trx":"TRX" };
    const channelList = ["ìŠˆì¹´ì›”ë“œ", "ì•Œê³ ë€", "ì°°ë¦¬ë¸Œë¼ì›…", "ì½”ì¸ë²„í•", "ë‚˜ì”¨ TV", "ë‹¥í„°ë¹„íŠ¸ë§¨", "ì†Œì£¼ëª½", "ì½”ì¸êµ¬ì¡°ëŒ€", "í•œë°©ì½”ì¸", "ë„ì§€ì•„ë¹ ", "ë¹„íŠ¸ë§¨", "ì½”ì¸ì™•ì", "ê°•í™˜êµ­", "ëˆë³µë‚¨", "ë°•í˜¸ë‘", "ë„ë¡œ", "ë§¤ì–µë‚¨", "ë²„ê±°í˜•", "ìŠ¤íŠ¸ë¦¬íŠ¸ ì‚¬ë‚˜ì´", "ì§­êµ¬", "ê°•ì€í˜¸", "ì‚¬ë˜", "í˜¸ì£¼ë¨¼", "ì½”ì¸íƒì •", "ë¶€ë¹—"];
    const indicators = [{id:"MASimple@tv-basicstudies", n:"Simple Moving Average (SMA)", desc:"ê°€ì¥ ê¸°ë³¸ì ì¸ ì´ë™í‰ê· ì„ . íŠ¹ì • ê¸°ê°„ì˜ ì¢…ê°€ í‰ê· ì„ ì—°ê²°í•©ë‹ˆë‹¤."}, {id:"MAExp@tv-basicstudies", n:"Exponential Moving Average (EMA)", desc:"ìµœê·¼ ê°€ê²©ì— ê°€ì¤‘ì¹˜ë¥¼ ë‘ì–´ ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•˜ëŠ” ì´ë™í‰ê· ì„ ì…ë‹ˆë‹¤."}, {id:"BB@tv-basicstudies", n:"Bollinger Bands", desc:"í‘œì¤€í¸ì°¨ë¥¼ ì´ìš©í•´ ê°€ê²© ë³€ë™ì„± ë²”ìœ„(ë°´ë“œ)ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."}, {id:"RSI@tv-basicstudies", n:"Relative Strength Index (RSI)", desc:"ê³¼ë§¤ìˆ˜(70ì´ìƒ)/ê³¼ë§¤ë„(30ì´í•˜) êµ¬ê°„ì„ íŒŒì•…í•˜ëŠ” ì˜¤ì‹¤ë ˆì´í„°ì…ë‹ˆë‹¤."}, {id:"MACD@tv-basicstudies", n:"MACD", desc:"ì´ë™í‰ê·  ìˆ˜ë ´í™•ì‚° ì§€ìˆ˜. ì¶”ì„¸ì˜ ë°©í–¥ê³¼ ê°•ë„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤."}, {id:"Stochastic@tv-basicstudies", n:"Stochastic Oscillator", desc:"í˜„ì¬ ê°€ê²©ì´ ì¼ì • ê¸°ê°„ ê°€ê²© ë²”ìœ„ ì¤‘ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ì§€ ë°±ë¶„ìœ¨ë¡œ í‘œì‹œí•©ë‹ˆë‹¤."}, {id:"IchimokuCloud@tv-basicstudies", n:"Ichimoku Cloud", desc:"ì „í™˜ì„ , ê¸°ì¤€ì„ , í›„í–‰ìŠ¤íŒ¬, êµ¬ë¦„ëŒ€ë¥¼ í†µí•´ ì§€ì§€/ì €í•­ê³¼ ì¶”ì„¸ë¥¼ ì¢…í•© ë¶„ì„í•©ë‹ˆë‹¤."}, {id:"ParabolicSAR@tv-basicstudies", n:"Parabolic SAR", desc:"ì ì„ ìœ¼ë¡œ ì¶”ì„¸ ì „í™˜ ì‹œì ì„ íŒŒì•…í•˜ê³  ì†ì ˆê°€ë¥¼ ì„¤ì •í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤."}, {id:"SuperTrend@tv-basicstudies", n:"SuperTrend", desc:"ê°€ê²© ë³€ë™ì„±ì„ ë°˜ì˜í•˜ì—¬ í˜„ì¬ ì¶”ì„¸(ìƒìŠ¹/í•˜ë½)ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤."}, {id:"Volume@tv-basicstudies", n:"Volume", desc:"ì‹œì¥ ì°¸ì—¬ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°€ì¥ ê¸°ì´ˆì ì´ê³  ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"VWAP@tv-basicstudies", n:"VWAP", desc:"ê±°ë˜ëŸ‰ ê°€ì¤‘ í‰ê·  ê°€ê²©. ê¸°ê´€ íˆ¬ììë“¤ì´ ì£¼ë¡œ ì°¸ê³ í•˜ëŠ” ê¸°ì¤€ ê°€ê²©ì…ë‹ˆë‹¤."}, {id:"OBV@tv-basicstudies", n:"On Balance Volume (OBV)", desc:"ê±°ë˜ëŸ‰ì„ í†µí•´ ì£¼ê°€ ì¶”ì„¸ì˜ í˜ì„ ë¶„ì„í•˜ëŠ” ëˆ„ì  ì§€í‘œì…ë‹ˆë‹¤."}, {id:"ATR@tv-basicstudies", n:"Average True Range (ATR)", desc:"ì‹œì¥ì˜ ë³€ë™ì„± í¬ê¸°ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤. ì†ì ˆí­ ì„¤ì •ì— ìœ ìš©í•©ë‹ˆë‹¤."}, {id:"CCI@tv-basicstudies", n:"Commodity Channel Index (CCI)", desc:"í˜„ì¬ ê°€ê²©ì´ ì´ë™í‰ê· ì„ ê³¼ ì–¼ë§ˆë‚˜ ë–¨ì–´ì ¸ ìˆëŠ”ì§€ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"MFI@tv-basicstudies", n:"Money Flow Index (MFI)", desc:"ê±°ë˜ëŸ‰ì„ ê³ ë ¤í•œ RSI. ìê¸ˆì˜ ìœ ì…ê³¼ ìœ ì¶œ ê°•ë„ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"ADX@tv-basicstudies", n:"Average Directional Index (ADX)", desc:"ì¶”ì„¸ì˜ 'ê°•ë„'ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤. ì¶”ì„¸ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ íŒë‹¨í•  ë•Œ ì”ë‹ˆë‹¤."}, {id:"PivotPointsStandard@tv-basicstudies", n:"Pivot Points Standard", desc:"ì „ì¼ ê³ ê°€, ì €ê°€, ì¢…ê°€ë¥¼ ì´ìš©í•´ ë‹¹ì¼ì˜ ì§€ì§€ì™€ ì €í•­ ìˆ˜ì¤€ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤."}, {id:"WilliamsAlligator@tv-basicstudies", n:"Williams Alligator", desc:"ì„¸ ê°€ì§€ ì´ë™í‰ê· ì„ ì„ ì•…ì–´ì˜ ì…ì— ë¹„ìœ í•˜ì—¬ ì¶”ì„¸ ì‹œì‘ì„ í¬ì°©í•©ë‹ˆë‹¤."}, {id:"TRIX@tv-basicstudies", n:"TRIX", desc:"ì§€ìˆ˜ ì´ë™í‰ê· ì˜ ë³€í™”ìœ¨ì„ ì„¸ ë²ˆ í‰í™œí™”í•˜ì—¬ ë…¸ì´ì¦ˆë¥¼ ì œê±°í•œ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"KST@tv-basicstudies", n:"Know Sure Thing (KST)", desc:"ë‹¤ì–‘í•œ ì£¼ê¸°ì˜ ROCë¥¼ ê°€ì¤‘ í‰ê· í•˜ì—¬ ì¥ê¸° ì¶”ì„¸ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤."}, {id:"ChaikinMoneyFlow@tv-basicstudies", n:"Chaikin Money Flow (CMF)", desc:"ë§¤ì§‘ê³¼ ë¶„ì‚°ì„ ì¸¡ì •í•˜ì—¬ ìê¸ˆì˜ íë¦„ì„ íŒŒì•…í•©ë‹ˆë‹¤."}, {id:"Aroon@tv-basicstudies", n:"Aroon", desc:"ì¶”ì„¸ì˜ ê°•ë„ì™€ ë°©í–¥ ì „í™˜ ê°€ëŠ¥ì„±ì„ ì¸¡ì •í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤."}, {id:"ChoppinessIndex@tv-basicstudies", n:"Choppiness Index", desc:"ì‹œì¥ì´ ì¶”ì„¸ êµ¬ê°„ì¸ì§€ íš¡ë³´(ë°•ìŠ¤ê¶Œ) êµ¬ê°„ì¸ì§€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤."}, {id:"ConnorsRSI@tv-basicstudies", n:"Connors RSI", desc:"ë‹¨ê¸° íŠ¸ë ˆì´ë”©ì— íŠ¹í™”ëœ RSIì˜ ë³€í˜• ë²„ì „ì…ë‹ˆë‹¤."}, {id:"FisherTransform@tv-basicstudies", n:"Fisher Transform", desc:"ê°€ê²© ë°ì´í„°ë¥¼ ì •ê·œ ë¶„í¬ë¡œ ë³€í™˜í•˜ì—¬ ë°˜ì „ ì‹ í˜¸ë¥¼ ëª…í™•íˆ í•©ë‹ˆë‹¤."}, {id:"HullMA@tv-basicstudies", n:"Hull Moving Average", desc:"ê¸°ì¡´ ì´ë™í‰ê· ì„ ì˜ í›„í–‰ì„±ì„ ê°œì„ í•˜ì—¬ ë°˜ì‘ ì†ë„ë¥¼ ë†’ì¸ ì´í‰ì„ ì…ë‹ˆë‹¤."}, {id:"KDJ@tv-basicstudies", n:"KDJ", desc:"ìŠ¤í† ìºìŠ¤í‹±ì— Jì„ ì„ ì¶”ê°€í•˜ì—¬ ë¯¼ê°ë„ë¥¼ ë†’ì¸ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"MassIndex@tv-basicstudies", n:"Mass Index", desc:"ê³ ê°€ì™€ ì €ê°€ì˜ í­(Range) ë³€í™”ë¥¼ í†µí•´ ì¶”ì„¸ ë°˜ì „ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤."}, {id:"PriceOscillator@tv-basicstudies", n:"Price Oscillator (PPO)", desc:"ë‘ ì´ë™í‰ê· ì„ ì˜ ì°¨ì´ë¥¼ ë¹„ìœ¨(%)ë¡œ ë‚˜íƒ€ë‚¸ ëª¨ë©˜í…€ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"RateOfChange@tv-basicstudies", n:"Rate Of Change (ROC)", desc:"ê¸ˆì¼ ê°€ê²©ê³¼ nì¼ ì „ ê°€ê²©ì„ ë¹„êµí•˜ì—¬ ë“±ë½ë¥ ì„ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"SMI@tv-basicstudies", n:"SMI Ergodic Indicator", desc:"ìŠ¤í† ìºìŠ¤í‹±ì„ ê°œì„ í•˜ì—¬ ì˜ëª»ëœ ì‹ í˜¸ë¥¼ ì¤„ì¸ ì˜¤ì‹¤ë ˆì´í„°ì…ë‹ˆë‹¤."}, {id:"SmoothedMA@tv-basicstudies", n:"Smoothed Moving Average", desc:"ë…¸ì´ì¦ˆë¥¼ ì¤„ì´ê¸° ìœ„í•´ í‰í™œí™”ëœ ì´ë™í‰ê· ì„ ì…ë‹ˆë‹¤."}, {id:"TripleEMA@tv-basicstudies", n:"Triple EMA (TEMA)", desc:"EMAë¥¼ ì„¸ ë²ˆ ê³„ì‚°í•˜ì—¬ í›„í–‰ì„±ì„ ê·¹ë„ë¡œ ì¤„ì¸ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"UltimateOscillator@tv-basicstudies", n:"Ultimate Oscillator", desc:"ë‹¨ê¸°, ì¤‘ê¸°, ì¥ê¸° ì••ë ¥ì„ ê²°í•©í•˜ì—¬ ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤."}, {id:"VolumeOscillator@tv-basicstudies", n:"Volume Oscillator", desc:"ë‹¨ê¸° ê±°ë˜ëŸ‰ ì´í‰ê³¼ ì¥ê¸° ê±°ë˜ëŸ‰ ì´í‰ì˜ ì°¨ì´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤."}, {id:"Vortex@tv-basicstudies", n:"Vortex Indicator", desc:"ê¸ì •ì /ë¶€ì •ì  ì¶”ì„¸ì˜ ì†Œìš©ëŒì´ë¥¼ í†µí•´ ì¶”ì„¸ ì „í™˜ì„ í¬ì°©í•©ë‹ˆë‹¤."}, {id:"VWMA@tv-basicstudies", n:"Volume Weighted Moving Average (VWMA)", desc:"ê±°ë˜ëŸ‰ì„ ê°€ì¤‘ì¹˜ë¡œ ë‘” ì´ë™í‰ê· ì„ ì…ë‹ˆë‹¤."}, {id:"WilliamsR@tv-basicstudies", n:"Williams %R", desc:"í˜„ì¬ ê°€ê²©ì´ ì§€ë‚œ ê¸°ê°„ì˜ ê°€ê²© ë²”ìœ„ ì¤‘ ì–´ë””ì— ìˆëŠ”ì§€ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"Donchian@tv-basicstudies", n:"Donchian Channels", desc:"ì¼ì • ê¸°ê°„ì˜ ìµœê³ ê°€ì™€ ìµœì €ê°€ë¥¼ ë°´ë“œë¡œ í‘œì‹œí•˜ì—¬ ëŒíŒŒ ë§¤ë§¤ì— ì”ë‹ˆë‹¤."}, {id:"KeltnerChannels@tv-basicstudies", n:"Keltner Channels", desc:"ATRì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë°´ë“œ ì§€í‘œë¡œ, ë³¼ë¦°ì € ë°´ë“œì™€ ìœ ì‚¬í•©ë‹ˆë‹¤."}, {id:"Envelopes@tv-basicstudies", n:"Envelopes", desc:"ì´ë™í‰ê· ì„  ìœ„ì•„ë˜ë¡œ ì¼ì • ë¹„ìœ¨(%)ë§Œí¼ ë–¨ì–´ì§„ ì„ ì„ ê·¸ë¦½ë‹ˆë‹¤."}, {id:"CorrelationCoefficient@tv-basicstudies", n:"Correlation Coefficient", desc:"ë‘ ìì‚° ê°„ì˜ ê°€ê²© ì›€ì§ì„ ì—°ê´€ì„±ì„ -1ì—ì„œ 1 ì‚¬ì´ë¡œ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"DetrendedPriceOscillator@tv-basicstudies", n:"Detrended Price Oscillator", desc:"ì¥ê¸° ì¶”ì„¸ë¥¼ ì œê±°í•˜ì—¬ ë‹¨ê¸° ì‚¬ì´í´ì„ íŒŒì•…í•˜ê¸° ì‰½ê²Œ í•©ë‹ˆë‹¤."}, {id:"EaseOfMovement@tv-basicstudies", n:"Ease Of Movement", desc:"ê°€ê²©ì´ ê±°ë˜ëŸ‰ì— ë¹„í•´ ì–¼ë§ˆë‚˜ ì‰½ê²Œ ì›€ì§ì´ëŠ”ì§€ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤."}, {id:"LinearRegression@tv-basicstudies", n:"Linear Regression", desc:"í†µê³„ì  ì¶”ì„¸ì„ ì„ ê·¸ë ¤ ê°€ê²©ì˜ ë°©í–¥ì„±ì„ ë³´ì—¬ì¤ë‹ˆë‹¤."}, {id:"MedianPrice@tv-basicstudies", n:"Median Price", desc:"ê³ ê°€ì™€ ì €ê°€ì˜ í‰ê· ê°’ìœ¼ë¡œ ì¶”ì„¸ë¥¼ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤."}, {id:"MoneyFlow@tv-basicstudies", n:"Money Flow", desc:"ê°€ê²©ê³¼ ê±°ë˜ëŸ‰ì„ ê²°í•©í•˜ì—¬ ìê¸ˆì˜ ìœ ì… ê°•ë„ë¥¼ ë´…ë‹ˆë‹¤."}, {id:"PriceVolumeTrend@tv-basicstudies", n:"Price Volume Trend", desc:"OBVì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ê°€ê²© ë“±ë½í­ê¹Œì§€ ë°˜ì˜í•œ ê±°ë˜ëŸ‰ ì§€í‘œì…ë‹ˆë‹¤."}, {id:"ZigZag@tv-basicstudies", n:"Zig Zag", desc:"ë…¸ì´ì¦ˆë¥¼ ì œê±°í•˜ê³  ì£¼ìš” ê³ ì ê³¼ ì €ì ì„ ì§ì„ ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤."}
    ];

    // [100ê°œ ë©”ë‰´ ë°ì´í„°]
    const infoMenus = [
        "ğŸš¨ ì‹¤ì‹œê°„ ë‰´ìŠ¤", "ğŸ˜± ê³µí¬/íƒìš• ì§€ìˆ˜", "ğŸ”¥ ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„", "ğŸ“Š ë¹„íŠ¸ì½”ì¸ ë„ë¯¸ë„ŒìŠ¤", "ğŸ³ ê³ ë˜ í¬ì°©", "ğŸ‡ºğŸ‡¸ ë‚˜ìŠ¤ë‹¥ ì„ ë¬¼", "ğŸ’µ ë‹¬ëŸ¬ ì¸ë±ìŠ¤ (DXY)", "ğŸª™ í…Œë” ë„ë¯¸ë„ŒìŠ¤", "ğŸ“ˆ ë¡±/ìˆ ë¹„ìœ¨", "ğŸ“‰ í€ë”©ë¹„ í˜„í™©", "ğŸ”“ ë½ì—… í•´ì œ", "â›ï¸ í•´ì‹œë ˆì´íŠ¸", "ğŸ¦ ë¯¸ ì—°ì¤€ ê¸ˆë¦¬", "ğŸ›’ CPI ì†Œë¹„ìë¬¼ê°€", "ğŸ­ PPI ìƒì‚°ìë¬¼ê°€", "ğŸ›¢ï¸ êµ­ì œ ìœ ê°€ (WTI)", "ğŸ¥‡ ê¸ˆ ì‹œì„¸", "ğŸ¥ˆ ì€ ì‹œì„¸", "ğŸ‘› ê±°ë˜ì†Œ ë³´ìœ ëŸ‰", "ğŸ—ºï¸ ì²­ì‚° ë§µ", "âš¡ ì´ë”ë¦¬ì›€ ê°€ìŠ¤ë¹„", "ğŸ’ NFT ê±°ë˜ëŸ‰", "ğŸš€ ë””íŒŒì´ (DeFi) TVL", "âš–ï¸ ìŠ¤í…Œì´ë¸”ì½”ì¸ ì‹œì´", "ğŸ“… ê²½ì œ ìº˜ë¦°ë”", "ğŸ§¢ ì‹œê°€ì´ì•¡ ìˆœìœ„", "ğŸ“ˆ ê¸‰ë“± ì½”ì¸", "ğŸ“‰ ê¸‰ë½ ì½”ì¸", "ğŸ¤– AI ë§¤ë§¤ ì‹œê·¸ë„", "ğŸ¦ íŠ¸ìœ„í„° íŠ¸ë Œë“œ", "ğŸ“‰ ë¯¸ê²°ì œ ì•½ì • (OI)", "ğŸ¯ RSI íˆíŠ¸ë§µ", "ğŸŒ¡ï¸ ì•ŒíŠ¸ì½”ì¸ ì‹œì¦Œ ì§€ìˆ˜", "ğŸ”„ ê±°ë˜ì†Œ ìœ ì¶œì…", "ğŸ’° ë¹„íŠ¸ì½”ì¸ ETF ìœ ì…", "ğŸ“‰ ì´ë”ë¦¬ì›€ ETF ìœ ì…", "ğŸ‹ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ í”„ë¦¬ë¯¸ì—„", "ğŸ¢ ë§ˆì´í¬ë¡œìŠ¤íŠ¸ë˜í‹°ì§€ ë³´ìœ ", "ğŸš— í…ŒìŠ¬ë¼ ë¹„íŠ¸ì½”ì¸ ë³´ìœ ", "â›ï¸ ì±„êµ´ ë‚œì´ë„", "ğŸ“Š ì±„êµ´ì ë³´ìœ ëŸ‰", "ğŸ“‰ MVRV ë¹„ìœ¨", "ğŸ“ˆ NUPL (ë¯¸ì‹¤í˜„ ì†ìµ)", "ğŸ”„ SOPR (ì§€ì¶œ ìˆ˜ìµë¥ )", "ğŸ“ í‘¸ì—˜ ë©€í‹°í”Œ", "ğŸ“‰ ìŠ¤í†¡ íˆ¬ í”Œë¡œìš°", "ğŸ¥§ íŒŒì´ ì‚¬ì´í´ íƒ‘", "ğŸ•¯ï¸ ê³¨ë“ /ë°ë“œ í¬ë¡œìŠ¤", "ğŸŒŠ ë³¼ë¦°ì € ë°´ë“œ ìŠ¤í€´ì¦ˆ", "ğŸ“‰ ë‹¤ì´ë²„ì „ìŠ¤ í¬ì°©", "ğŸŒ ë ˆì´ì–´ 1 (L1) íŠ¸ë Œë“œ", "âš¡ ë ˆì´ì–´ 2 (L2) íŠ¸ë Œë“œ", "ğŸ® ê²Œì„/P2E ì„¹í„°", "ğŸ§  AI ì½”ì¸ ì„¹í„°", "ğŸ• ë°ˆ ì½”ì¸ ì„¹í„°", "ğŸ•¶ï¸ í”„ë¼ì´ë²„ì‹œ ì½”ì¸", "ğŸ’¾ ì €ì¥ì„±(Storage) ì½”ì¸", "ğŸ”— ì˜¤ë¼í´(Oracle) ì„¹í„°", "ğŸ¦ DAO ê±°ë²„ë„ŒìŠ¤", "ğŸš€ ëŸ°ì¹˜íŒ¨ë“œ ì¼ì •", "ğŸ ì—ì–´ë“œë ì¼ì •", "âœ‚ï¸ ë°˜ê°ê¸° ì¹´ìš´íŠ¸ë‹¤ìš´", "ğŸ‡°ğŸ‡· ì—…ë¹„íŠ¸ ê±°ë˜ëŸ‰", "ğŸ‡°ğŸ‡· ë¹—ì¸ ê±°ë˜ëŸ‰", "ğŸš¨ íŠ¸ë˜ë¸”ë£° í˜„í™©", "ğŸ“‰ ì‹¤ì—…ìˆ˜ë‹¹ ì²­êµ¬", "ğŸ“Š ë¯¸êµ­ GDP ì„±ì¥ë¥ ", "ğŸ’³ ê°œì¸ì†Œë¹„ì§€ì¶œ (PCE)", "ğŸ“‰ ë¯¸êµ­ 10ë…„ë¬¼ êµ­ì±„", "ğŸ˜¨ VIX ê³µí¬ì§€ìˆ˜", "ğŸ“‰ êµ¬ë¦¬ ì‹œì„¸", "ğŸŒ¾ ì›ìì¬ ì¢…í•©", "ğŸ“‰ í™˜ìœ¨ (ì—”/ë‹¬ëŸ¬)", "ğŸ“‰ í™˜ìœ¨ (ìœ ë¡œ/ë‹¬ëŸ¬)", "ğŸ¤– ì±—GPT ì½”ì¸ ë¶„ì„", "ğŸ” êµ¬ê¸€ ê²€ìƒ‰ íŠ¸ë Œë“œ", "ğŸ“± í…”ë ˆê·¸ë¨ í˜¸ì¬", "ğŸ“ ë ˆë”§ ì»¤ë®¤ë‹ˆí‹°", "ğŸ’» ê¹ƒí—ˆë¸Œ ê°œë°œ í™œì„±ë„", "ğŸ“‰ í™œì„± ì§€ê°‘ ìˆ˜", "ğŸ”„ íŠ¸ëœì­ì…˜ ìˆ˜", "ğŸ’° í‰ê·  ê±°ë˜ ìˆ˜ìˆ˜ë£Œ", "âš¡ ë¼ì´íŠ¸ë‹ ë„¤íŠ¸ì›Œí¬", "ğŸŒ‰ ë¸Œë¦¿ì§€ ê±°ë˜ëŸ‰", "ğŸ“‰ ë±ìŠ¤(DEX) ê±°ë˜ëŸ‰", "ğŸ¥© ìŠ¤í…Œì´í‚¹ ë¹„ìœ¨", "ğŸ”¥ ì†Œê°(Burn) í˜„í™©", "ğŸ“‰ ì¸í”Œë ˆì´ì…˜ìœ¨", "ğŸ¦ ì¤‘ì•™ì€í–‰ ëŒ€ì°¨ëŒ€ì¡°í‘œ", "ğŸ“‰ ì˜µì…˜ ë§Œê¸°ì¼", "ğŸ¯ ë§¥ìŠ¤ í˜ì¸ ê°€ê²©", "ğŸ“‰ ë‚´ì¬ ë³€ë™ì„± (IV)", "ğŸ“‰ ì—­ì‚¬ì  ë³€ë™ì„± (HV)", "âš–ï¸ ì½”ì¸ë² ì´ìŠ¤ í”„ë¦¬ë¯¸ì—„", "ğŸ‡°ğŸ‡· ê¹€í”„ ì°¨íŠ¸ (ì—­í”„)", "ğŸ“‰ ë°”ì´ë‚¸ìŠ¤ í€ë”©ë¹„", "ğŸ“‰ ë°”ì´ë¹„íŠ¸ í€ë”©ë¹„", "ğŸ‹ ê³ ë˜ ì§€ê°‘ ì´ë™", "ğŸš¨ í•´í‚¹/ë³´ì•ˆ ì´ìŠˆ", "ğŸ“° ì£¼ìš” ê±°ë˜ì†Œ ê³µì§€"
    ];

    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        el('themeBtn').innerText = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        el('homeTitle').innerText = `${curExCode} ê³„ì‚°ê¸°`;
        
        updateCoinLabels(curSym);
        connectWS(curSym);
        initInfoMenu();
        initIndi();
        initDetailIndi();
        initYtBoard();
        
        // Sticky Top Logic
        const pageYoutube = el('page-youtube');
        pageYoutube.addEventListener('scroll', () => {
            const playerCon = el('ytPlayerContainer');
            const placeholder = el('ytPlaceholder');
            // ì „ì²´í™”ë©´ì´ ì•„ë‹ ë•Œë§Œ Sticky ì‘ë™
            if (playerCon.style.display !== 'none' && !isVerticalFull) {
                if (pageYoutube.scrollTop > 10) {
                    playerCon.classList.add('sticky-top-mode');
                    placeholder.style.display = 'block';
                } else {
                    playerCon.classList.remove('sticky-top-mode');
                    placeholder.style.display = 'none';
                }
            }
        });

        // ğŸ“± ê°€ë¡œ/ì„¸ë¡œ íšŒì „ ì‹œ ìë™ ì „ì²´í™”ë©´
        window.addEventListener("orientationchange", () => {
            const playerCon = el('ytPlayerContainer');
            if (window.orientation === 90 || window.orientation === -90) {
                isVerticalFull = true;
                playerCon.classList.add('full-mode');
                playerCon.classList.remove('sticky-top-mode');
            } else {
                isVerticalFull = false;
                playerCon.classList.remove('full-mode');
            }
        });
    });

    // ì„¸ë¡œ ì „ì²´í™”ë©´ í† ê¸€
    function toggleVerticalFull() {
        const playerCon = el('ytPlayerContainer');
        isVerticalFull = !isVerticalFull;

        if (isVerticalFull) {
            playerCon.classList.add('full-mode');
            playerCon.classList.remove('sticky-top-mode'); 
        } else {
            playerCon.classList.remove('full-mode');
            // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ë‹¤ì‹œ ìŠ¤í‹°í‚¤ ì ìš©
            const pageYoutube = el('page-youtube');
            if (pageYoutube.scrollTop > 10) {
                playerCon.classList.add('sticky-top-mode');
            }
        }
    }

    function goPage(pageId) {
        document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el('page-'+pageId).classList.add('active');
        const navIdx = {'home':0, 'youtube':1, 'chart':2, 'ex':3, 'info':4}[pageId];
        document.querySelectorAll('.nav-item')[navIdx].classList.add('active');
        if(pageId === 'chart') setTimeout(loadChart, 300);
        if(pageId === 'youtube' && !el('youtubeList').innerHTML.includes('yt-item')) { el('ytSearch').value = curSym; searchYoutube(); }
        if(pageId !== 'info') isDetailOpen = false;
    }

    function goToNewsBoard() {
        goPage('info'); 
        openBoard(`${curSym} ê´€ë ¨ ì£¼ìš” ì†Œì‹`);
    }

    function toggleTheme() {
        const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        el('themeBtn').innerText = next === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        if(el('page-chart').classList.contains('active')) loadChart();
    }

    function chgCoin() {
        const input = el('search').value.trim();
        if(input) {
            let symbol = coinMap[input] || coinMap[input.toLowerCase()] || input.toUpperCase();
            changeSymbol(symbol);
            el('search').value = ""; el('search').placeholder = `${symbol} ê²€ìƒ‰ë¨`; el('search').blur();
        }
    }
    
    function changeSymbol(symbol) {
        if(symbol !== curSym) {
            curSym = symbol; localStorage.setItem('curSym', curSym);
            priceKr = 0; priceUs = 0;
            el('tKr').innerText = "..."; el('tUs').innerText = "...";
            updateCoinLabels(curSym); connectWS(curSym);
        }
    }

    function updateCoinLabels(sym) { el('lblKrSym').innerText = sym; el('lblUsSym').innerText = sym; }

    let wsUpbit, wsBinance;
    function connectWS(sym) {
        if(wsUpbit) wsUpbit.close();
        wsUpbit = new WebSocket('wss://api.upbit.com/websocket/v1');
        wsUpbit.onopen = () => wsUpbit.send(JSON.stringify([{"ticket":"test"},{"type":"ticker","codes":[`KRW-${sym}`, "KRW-USDT"]}]));
        wsUpbit.onmessage = async(e) => {
            const d = JSON.parse(await e.data.text());
            if (d.code === "KRW-USDT") { exRate = d.trade_price; el('exRateVal').innerText = `${Math.floor(exRate).toLocaleString()} ì›`; } 
            else {
                priceKr = d.trade_price; el('tKr').innerText = priceKr.toLocaleString();
                if(!el('nP').value && calcMode === 'KRW') el('nP').placeholder = priceKr.toLocaleString();
                if(el('cP').value) cal(); calcPremium();
                if(isDetailOpen && detailSymbol === curSym) renderAIReport();
            }
        };
        if(wsBinance) wsBinance.close();
        const symbol = sym.toLowerCase() + "usdt";
        wsBinance = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@ticker`);
        wsBinance.onmessage = (e) => {
            const d = JSON.parse(e.data); priceUs = parseFloat(d.c);
            el('tUs').innerText = priceUs.toLocaleString(undefined, {minimumFractionDigits: 2});
            if(exRate > 0) el('tUsCvt').innerText = `â‰ˆ ${Math.floor(priceUs * exRate).toLocaleString()} KRW`;
            if(!el('nP').value && calcMode === 'USDT') el('nP').placeholder = priceUs.toLocaleString(undefined, {minimumFractionDigits: 4});
            calcPremium(); if(isDetailOpen && detailSymbol === curSym) renderAIReport();
        };
    }

    function calcPremium() {
        if(priceKr > 0 && priceUs > 0) {
            const prem = ((priceKr - (priceUs * exRate)) / (priceUs * exRate)) * 100;
            el('premVal').innerText = `${prem.toFixed(2)}%`; el('premVal').style.color = prem > 0 ? 'var(--up)' : 'var(--down)';
        }
    }

    function setCalcMode(mode) {
        calcMode = mode;
        el('btnKrw').className = mode === 'KRW' ? 'mode-btn active' : 'mode-btn';
        el('btnUsdt').className = mode === 'USDT' ? 'mode-btn active' : 'mode-btn';
        const unit = mode === 'KRW' ? 'ì›' : '$';
        el('nA').placeholder = `ê¸ˆì•¡ ì…ë ¥ (${unit})`;
        if(mode === 'KRW' && priceKr > 0) el('nP').placeholder = priceKr.toLocaleString();
        if(mode === 'USDT' && priceUs > 0) el('nP').placeholder = priceUs.toLocaleString(undefined, {minimumFractionDigits: 4});
        cal(); 
    }

    function cal(mode) {
        const cp = parseFloat(el('cP').value)||0, cq = parseFloat(el('cQ').value)||0;
        let np = parseFloat(el('nP').value); 
        if(!np) np = (calcMode === 'KRW' ? priceKr : priceUs) || 0;
        
        let nq = parseFloat(el('nQ').value)||0, na = parseFloat(el('nA').value)||0;
        if(np > 0) { 
            if(mode===1) { nq = na/np; el('nQ').value = parseFloat(nq.toFixed(8)); } 
            else if(mode===0) { na = np*nq; el('nA').value = calcMode==='KRW' ? Math.floor(na) : parseFloat(na.toFixed(2)); } 
        }
        
        const tQ = cq+nq, tA = (cp*cq)+na, avg = tQ>0 ? tA/tQ : 0;
        
        const fmt = (num) => calcMode === 'KRW' ? Math.floor(num).toLocaleString() : num.toLocaleString(undefined, {minimumFractionDigits: 4});
        const fmtAmt = (num) => calcMode === 'KRW' ? Math.floor(num).toLocaleString() : num.toLocaleString(undefined, {minimumFractionDigits: 2});

        el('fAv').innerText = fmt(avg);
        el('resQty').innerText = parseFloat(tQ.toFixed(8)).toLocaleString();
        el('resAmt').innerText = fmtAmt(tA);
        
        if(np>0 && tA>0) { 
            const pnl = ((tQ*np - tA)/tA)*100; 
            el('resPnl').innerHTML = `<span class="${pnl>0?'c-up':'c-down'}">${pnl.toFixed(2)}%</span>`; 
        }
    }
    function rst() { ['cP','cQ','nP','nA','nQ'].forEach(i=>el(i).value=''); el('fAv').innerText='0'; el('resPnl').innerText='0.00%'; }
    function setEx(code, name) { curExCode = code; localStorage.setItem('curExCode', code); el('homeTitle').innerText = `${code} ê³„ì‚°ê¸°`; alert(`${name} ì„¤ì •ë¨`); goPage('home'); connectWS(curSym); }

    function initYtBoard() {
        const board = el('ytBoardContainer');
        let html = '';
        channelList.forEach(name => {
            html += `<div class="yt-board-item" onclick="searchAndPlayChannel('${name}')">${name} <span>ê²€ìƒ‰ â–¶</span></div>`;
        });
        board.innerHTML = html;
    }
    function toggleYtBoard() { const board = el('ytBoardContainer'); board.style.display = board.style.display === 'block' ? 'none' : 'block'; }
    async function searchAndPlayChannel(keyword) { el('ytSearch').value = keyword; await searchYoutube(true); }
    async function searchYoutube(autoPlay = false) {
        const query = el('ytSearch').value.trim();
        const sort = el('ytSort').value; 
        if(!query) return;
        
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(query)}&order=${sort}&type=video&key=${YOUTUBE_API_KEY}`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();
            if(!data.items) { el('youtubeList').innerHTML = '<div style="padding:20px; text-align:center;">API í‚¤ ì˜¤ë¥˜ ë˜ëŠ” ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>'; return; }
            renderVideoList(data.items);
            if(autoPlay && data.items.length > 0) playVideo(data.items[0].id.videoId);
        } catch(e) { console.error(e); }
    }
    function renderVideoList(items) {
        let h = '';
        items.forEach(item => {
            const vidId = item.id.videoId;
            const title = item.snippet.title;
            const thumb = item.snippet.thumbnails.medium.url;
            const channel = item.snippet.channelTitle;
            const pubDate = item.snippet.publishedAt.substring(0, 10);

            h += `<div class="yt-item" onclick="playVideo('${vidId}')">
                    <div class="yt-thumb" style="background-image:url('${thumb}');"></div>
                    <div class="yt-info">
                        <div class="yt-title">${title}</div>
                        <div class="yt-chan">${channel} â€¢ ${pubDate}</div>
                    </div>
                  </div>`;
        });
        el('youtubeList').innerHTML = h;
    }
    
    // [FIXED] Use standard YouTube Embed URL to prevent Error 153
    function playVideo(vidId) {
        currentVideoId = vidId;
        el('ytPlayerContainer').style.display = 'block';
        el('ytSoundBtn').style.display = 'block'; // ì†Œë¦¬ ë²„íŠ¼ í‘œì‹œ
        el('ytIframe').src = `http://www.youtube.com/embed/${vidId}?autoplay=1&mute=1&enablejsapi=1&playsinline=1`;
        window.scrollTo(0, 0);
    }
    
    function unmuteVideo() {
        if(!currentVideoId) return;
        el('ytSoundBtn').style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¹€
        el('ytIframe').src = `http://www.youtube.com/embed/${currentVideoId}?autoplay=1&mute=0&enablejsapi=1&playsinline=1`;
    }
    
    function closeYtPlayer() { }

    function initInfoMenu() { 
        let h = ''; 
        infoMenus.forEach(m => { 
            const icon = m.split(' ')[0];
            const text = m.replace(icon, '').trim();
            h += `<div class="info-menu-item" onclick="openBoard('${m}')">
                    <div class="info-menu-icon">${icon}</div>
                    <div class="info-menu-title">${text}</div>
                  </div>`; 
        }); 
        el('infoMenuContainer').innerHTML = h; 
    }
    
    function searchInfo() { const input = el('infoSearch').value.trim(); if(input.length>0) { let symbol = coinMap[input] || input.toUpperCase(); changeSymbol(symbol); openBoard(`${symbol} ê²€ìƒ‰ ê²°ê³¼`); } else { closeBoard(); } }
    function openBoard(title) { el('infoMenuContainer').style.display='none'; el('infoBoardContainer').style.display='block'; el('boardTitle').innerText=title; currentBoardData = generateMockData(title); let h=''; currentBoardData.forEach((item,i)=>{ h+=`<div class="info-card" onclick="openDetail(${i})"><div><span class="post-tag">${item.tag}</span><span style="font-weight:700;">${item.title}</span></div></div>`; }); el('boardList').innerHTML=h; }
    
    function openDetail(index) { 
        const item = currentBoardData[index];
        el('infoBoardContainer').style.display='none'; 
        el('infoDetailContainer').style.display='block'; 
        el('detailTitle').innerText = item.title; 
        el('detailDate').innerText = `${item.date} â€¢ ì¡°íšŒìˆ˜ ${Math.floor(Math.random()*2000)}`; 
        el('detailBody').innerHTML = item.content;
        detailSymbol = curSym; 
        
        let chartEx = curExCode;
        if(['COINONE','KORBIT','GOPAX'].includes(curExCode)) chartEx = 'UPBIT'; 
        if(['BITGET','GATEIO','KUCOIN','HUOBI','BITSTAMP'].includes(curExCode)) chartEx = 'BINANCE'; 
        const chartSym = `${chartEx}:${curSym}${['UPBIT','BITHUMB'].includes(chartEx)?'KRW':'USDT'}`;
        el('detailChartContainer').innerHTML = '';
        new TradingView.widget({ "autosize": true, "symbol": chartSym, "interval": "60", "timezone": "Asia/Seoul", "theme": document.documentElement.getAttribute('data-theme'), "style": "1", "locale": "kr", "toolbar_bg": "#f1f3f6", "enable_publishing": false, "hide_top_toolbar": true, "container_id": "detailChartContainer" });

        el('aiAnalysisContainer').innerHTML='<div style="text-align:center; padding:30px;">ğŸ”„ ë°ì´í„° ìˆ˜ì‹ ì¤‘...</div>'; 
        if(priceKr>0) renderAIReport(); 
    }

    function renderAIReport() { 
        const p = priceKr || 0; if(p===0) return;
        const sup = Math.floor(p * 0.98).toLocaleString();
        const res = Math.floor(p * 1.02).toLocaleString();
        const stop = Math.floor(p * 0.97).toLocaleString();
        const target = Math.floor(p * 1.05).toLocaleString();
        const score = Math.floor(Math.random() * 20) + 70;

        el('aiAnalysisContainer').innerHTML = `
            <div class="ai-report-box">
                <div class="ai-header"><span class="ai-badge">ğŸ¤– AI ë¶„ì„ ì™„ë£Œ</span><div class="ai-score">${score} <span style="font-size:12px; color:#999;">/ 100</span></div></div>
                <div class="price-dual"><span style="color:var(--up); font-size:20px; font-weight:bold;">${p.toLocaleString()} KRW</span></div>
                <div style="text-align:center; margin-bottom:15px; font-weight:bold; font-size:14px;">"í˜„ì¬ êµ¬ê°„ì€ <span style="color:var(--up);">ê°•í•œ ë§¤ìˆ˜</span>ê°€ ìœ íš¨í•©ë‹ˆë‹¤."</div>
                <div class="strat-grid">
                    <div class="strat-item"><div class="strat-label">ë‹¨ê¸° ì§€ì§€</div><div class="strat-val" style="color:var(--up)">${sup}</div></div>
                    <div class="strat-item"><div class="strat-label">ë‹¨ê¸° ì €í•­</div><div class="strat-val" style="color:var(--down)">${res}</div></div>
                    <div class="strat-item"><div class="strat-label">ì†ì ˆê°€</div><div class="strat-val">${stop}</div></div>
                    <div class="strat-item"><div class="strat-label">ëª©í‘œê°€</div><div class="strat-val">${target}</div></div>
                </div>
            </div>`; 
    }

    function closeBoard() { el('infoBoardContainer').style.display='none'; el('infoMenuContainer').style.display='grid'; }
    function closeDetail() { el('infoDetailContainer').style.display='none'; el('infoBoardContainer').style.display='block'; isDetailOpen=false; }
    
    function generateMockData(k) { 
        let data = [];
        const today = new Date().toISOString().split('T')[0];
        const keyword = k.includes("ê´€ë ¨") ? k.split(" ")[0] : k;
        for(let i=1; i<=10; i++) {
            data.push({
                tag: "NEWS", title: `${keyword} ê´€ë ¨ ê¸´ê¸‰ ë¶„ì„ ë¦¬í¬íŠ¸ #${i}`, date: today, 
                content: `<b>[${keyword} ì‹¬ì¸µ ë¶„ì„ ë³´ê³ ì„œ]</b>\n\ní˜„ì¬ ${keyword}ì˜ ì‹œì„¸ ë³€ë™ì„±ì´ í™•ëŒ€ë˜ê³  ìˆìŠµë‹ˆë‹¤. AI ì•Œê³ ë¦¬ì¦˜ ë¶„ì„ ê²°ê³¼, ë‹¨ê¸°ì ì¸ ë§¤ìˆ˜ì„¸ ìœ ì…ì´ í¬ì°©ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n<b>1. ì˜¨ì²´ì¸ ë°ì´í„° ë¶„ì„</b>\nê³ ë˜ íˆ¬ììë“¤ì˜ ì§€ê°‘ ì´ë™ì´ ê°ì§€ë˜ì—ˆìœ¼ë©°, ê±°ë˜ì†Œë¡œì˜ ìœ ì…ë³´ë‹¤ëŠ” ê°œë³„ ì§€ê°‘ìœ¼ë¡œì˜ ì´ë™ì´ ë§ì•„ í™€ë”©(Holding) ê´€ì ì´ ìš°ì„¸í•©ë‹ˆë‹¤.\n\n<b>2. ê¸°ìˆ ì  ë¶„ì„</b>\nRSI ì§€í‘œì™€ MACD ê³¨ë“ í¬ë¡œìŠ¤ ì‹ í˜¸ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì£¼ìš” ì§€ì§€ì„ ì„ ì§€ì¼œì¤€ë‹¤ë©´ ìƒìŠ¹ ì¶”ì„¸ë¡œì˜ ì „í™˜ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.\n\n<b>3. ëŒ€ì‘ ì „ëµ</b>\në¶„í•  ë§¤ìˆ˜ ì ‘ê·¼ì´ ìœ íš¨í•˜ë©°, ê¸‰ê²©í•œ ë³€ë™ì„±ì— ëŒ€ë¹„í•´ ì†ì ˆê°€ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.`
            });
        }
        return data; 
    }
    
    function getIndiIcon(name) {
        if(name.includes("SMA") || name.includes("EMA")) return "ğŸ“ˆ";
        if(name.includes("Bollinger")) return "âš¡";
        if(name.includes("RSI")) return "ğŸŒŠ";
        if(name.includes("MACD")) return "ğŸš€";
        if(name.includes("Volume")) return "ğŸ“Š";
        if(name.includes("Parabolic")) return "ğŸ¹";
        if(name.includes("Ichimoku")) return "â˜ï¸";
        return "ğŸ“‰";
    }

    // 1. ê¸°ë³¸ ì•„ì´ì½˜ ëª¨ë‹¬
    function initIndi() { 
        let h=''; 
        indicators.forEach(i=>{ 
            const act=activeStudies.includes(i.id)?'active':''; 
            const icon = getIndiIcon(i.n);
            let shortName = i.n.split(' ')[0];
            h+=`<div class="indi-card ${act}" onclick="toggleIndi('${i.id}')"><div class="indi-icon">${icon}</div><div class="indi-name">${shortName}</div></div>`; 
        }); 
        el('indiList').innerHTML=h; 
    }

    // 2. ìƒì„¸ ì„¤ëª… ëª¨ë‹¬ (ë°”ë‘‘íŒì‹)
    function initDetailIndi() {
        let h = '';
        indicators.forEach(i => {
            const act = activeStudies.includes(i.id) ? 'active' : '';
            const icon = getIndiIcon(i.n);
            h += `<div class="detail-indi-card ${act}" onclick="toggleIndi('${i.id}')">
                    <div class="dic-icon">${icon}</div>
                    <div class="dic-content">
                        <div class="dic-name">${i.n}</div>
                        <div class="dic-desc">${i.desc}</div>
                    </div>
                  </div>`;
        });
        el('detailIndiList').innerHTML = h;
    }
    
    function toggleIndi(id) { 
        if(activeStudies.includes(id)) activeStudies=activeStudies.filter(x=>x!==id); 
        else activeStudies.push(id); 
        initIndi(); 
        initDetailIndi(); 
    }

    function openDetailIndiModal() {
        initDetailIndi();
        el('detailIndiModal').style.display='flex';
    }

    function applyStudies() { localStorage.setItem('activeStudies', JSON.stringify(activeStudies)); el('indiModal').style.display='none'; el('detailIndiModal').style.display='none'; if(el('page-chart').classList.contains('active')) loadChart(); }
    
    function loadChart() {
        if(typeof TradingView === 'undefined') { setTimeout(loadChart, 500); return; }
        el('chartContainer').innerHTML = '';
        let chartEx = curExCode;
        if(['COINONE','KORBIT','GOPAX'].includes(curExCode)) chartEx = 'UPBIT'; 
        if(['BITGET','GATEIO','KUCOIN','HUOBI','BITSTAMP'].includes(curExCode)) chartEx = 'BINANCE'; 
        const chartSym = `${chartEx}:${curSym}${['UPBIT','BITHUMB'].includes(chartEx)?'KRW':'USDT'}`;
        new TradingView.widget({ "autosize": true, "symbol": chartSym, "interval": "60", "timezone": "Asia/Seoul", "theme": document.documentElement.getAttribute('data-theme'), "style": "1", "locale": "kr", "toolbar_bg": "#f1f3f6", "enable_publishing": false, "allow_symbol_change": true, "container_id": "chartContainer", "studies": activeStudies });
    }
</script>
</body>
</html>
